{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "availability",
  "type": "registry:block",
  "title": "Availability",
  "description": "A weekly availability designer with draggable and resizable time slots.",
  "dependencies": ["lucide-react", "@radix-ui/react-slot", "class-variance-authority"],
  "registryDependencies": ["button"],
  "files": [
    {
      "path": "registry/abui/ui/availability.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Settings, X } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\n// --- Types ---\n\nexport interface TimeSpan {\n  active?: boolean\n  nanoid: string\n  week_day: number // 0-6 - Sunday-Saturday\n  start_time: string // \"HH:mm\"\n  end_time: string // \"HH:mm\"\n}\n\ninterface AvailabilityProps {\n  value?: TimeSpan[]\n  onValueChange?: (value: TimeSpan[]) => void\n  days?: number[] // 0-6\n  timeIncrements?: number // minutes, default 30\n  startTime?: number // hour 0-23, default 7\n  endTime?: number // hour 0-23, default 23\n  useAmPm?: boolean\n  className?: string\n}\n\n// --- Utils ---\n\nconst timeToMinutes = (time: string) => {\n  const [h, m] = time.split(\":\").map(Number)\n  return h * 60 + m\n}\n\nconst minutesToTime = (minutes: number) => {\n  const h = Math.floor(minutes / 60)\n  const m = minutes % 60\n  return `${h.toString().padStart(2, \"0\")}:${m.toString().padStart(2, \"0\")}`\n}\n\nconst formatDisplayTime = (time: string, useAmPm: boolean) => {\n  if (!useAmPm) return time\n  const [h, m] = time.split(\":\").map(Number)\n  const ampm = h >= 12 ? \"PM\" : \"AM\"\n  const h12 = h % 12 || 12\n  return `${h12}:${m.toString().padStart(2, \"0\")} ${ampm}`\n}\n\nconst generateId = () => Math.random().toString(36).substring(2, 11)\n\nconst DAYS = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"]\n\n// --- Components ---\n\nexport function Availability({\n  value = [],\n  onValueChange,\n  days = [0, 1, 2, 3, 4, 5, 6],\n  timeIncrements = 30,\n  startTime = 7,\n  endTime = 23,\n  useAmPm = false,\n  className,\n}: AvailabilityProps) {\n  const [internalValue, setInternalValue] = React.useState<TimeSpan[]>(value)\n\n  // Sync controlled/uncontrolled state\n  React.useEffect(() => {\n    setInternalValue(value)\n  }, [value])\n\n  const updateValue = (newValue: TimeSpan[]) => {\n    setInternalValue(newValue)\n    onValueChange?.(newValue)\n  }\n\n  // --- Handlers ---\n\n  const handleResize = (id: string, newStart: string, newEnd: string) => {\n    const newValue = internalValue.map(span => {\n      if (span.nanoid === id) {\n        return { ...span, start_time: newStart, end_time: newEnd }\n      }\n      return span\n    })\n    updateValue(newValue)\n  }\n\n  const handleCreate = (dayIndex: number, startMinutes: number, endMinutes: number) => {\n    const newSpan: TimeSpan = {\n      nanoid: generateId(),\n      week_day: days[dayIndex],\n      start_time: minutesToTime(startMinutes),\n      end_time: minutesToTime(endMinutes),\n      active: true,\n    }\n    updateValue([...internalValue, newSpan])\n  }\n\n  const handleDelete = (id: string) => {\n    updateValue(internalValue.filter(s => s.nanoid !== id))\n  }\n\n  return (\n    <div\n      className={cn(\n        \"flex h-[600px] w-full flex-col overflow-hidden rounded-md border bg-background select-none\",\n        className,\n      )}\n    >\n      {/* Header */}\n      <div className=\"flex w-full border-b bg-muted/40\">\n        <div className=\"w-16 flex-shrink-0 border-r p-2 text-xs font-medium text-muted-foreground\">\n          {/* Time label column header */}\n        </div>\n        <div className=\"flex flex-1\">\n          {days.map(dayIndex => (\n            <div key={dayIndex} className=\"flex-1 border-r px-2 py-3 text-center text-sm font-medium last:border-r-0\">\n              {DAYS[dayIndex]}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Body */}\n      <div className=\"flex flex-1 overflow-y-auto relative\">\n        {/* Time Labels */}\n        <div className=\"w-16 flex-shrink-0 border-r bg-muted/10 flex flex-col\">\n          {Array.from({ length: endTime - startTime }).map((_, i) => {\n            const hour = startTime + i\n            return (\n              <div\n                key={hour}\n                className=\"flex-1 border-b border-dashed border-muted-foreground/20 relative flex items-center justify-start pl-3\"\n              >\n                <span className=\"text-xs text-muted-foreground\">{formatDisplayTime(`${hour}:00`, useAmPm)}</span>\n              </div>\n            )\n          })}\n        </div>\n\n        {/* Days Grid */}\n        <div className=\"flex flex-1 relative\">\n          {/* Background Grid Lines - Matches exact structure of Time Labels */}\n          <div className=\"absolute inset-0 pointer-events-none flex flex-col\">\n            {Array.from({ length: endTime - startTime }).map((_, i) => (\n              <div key={i} className=\"flex-1 border-b border-dashed border-muted/20 w-full relative\">\n                {/* We can also add intermediate lines if needed for 30min increments, but let's stick to hours for now to match left column */}\n              </div>\n            ))}\n          </div>\n\n          {days.map((dayIndex, i) => (\n            <DayColumn\n              key={dayIndex}\n              dayIndex={dayIndex}\n              colIndex={i}\n              startTime={startTime}\n              endTime={endTime}\n              timeIncrements={timeIncrements}\n              events={internalValue.filter(e => e.week_day === dayIndex)}\n              onCreate={handleCreate}\n              onResize={handleResize}\n              onDelete={handleDelete}\n              useAmPm={useAmPm}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// --- Sub Components ---\n\ninterface DayColumnProps {\n  dayIndex: number\n  colIndex: number\n  startTime: number\n  endTime: number\n  timeIncrements: number\n  events: TimeSpan[]\n  onCreate: (dayIndex: number, start: number, end: number) => void\n  onResize: (id: string, start: string, end: string) => void\n  onDelete: (id: string) => void\n  useAmPm: boolean\n}\n\nfunction DayColumn({\n  dayIndex,\n  colIndex,\n  startTime,\n  endTime,\n  timeIncrements,\n  events,\n  onCreate,\n  onResize,\n  onDelete,\n  useAmPm,\n}: DayColumnProps) {\n  const containerRef = React.useRef<HTMLDivElement>(null)\n  const [isCreating, setIsCreating] = React.useState(false)\n  const [creationStart, setCreationStart] = React.useState<number | null>(null)\n  const [currentMouseY, setCurrentMouseY] = React.useState<number | null>(null)\n\n  const totalMinutes = (endTime - startTime) * 60\n  const startOffset = startTime * 60\n\n  // Sort events by start time to determine constraints\n  const sortedEvents = React.useMemo(() => {\n    return [...events].sort((a, b) => timeToMinutes(a.start_time) - timeToMinutes(b.start_time))\n  }, [events])\n\n  const getMinutesFromY = (y: number) => {\n    if (!containerRef.current) return 0\n    const rect = containerRef.current.getBoundingClientRect()\n    const relativeY = y - rect.top\n    const percentage = Math.max(0, Math.min(1, relativeY / rect.height))\n    const minutes = percentage * totalMinutes + startOffset\n    return Math.round(minutes / timeIncrements) * timeIncrements\n  }\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (e.target !== e.currentTarget) return // Only trigger on empty space\n    e.preventDefault() // Prevent text selection\n\n    const startMins = getMinutesFromY(e.clientY)\n\n    // Check strict overlap at start point\n    const isOverlapping = sortedEvents.some(ev => {\n      const s = timeToMinutes(ev.start_time)\n      const e = timeToMinutes(ev.end_time)\n      return startMins >= s && startMins < e\n    })\n    if (isOverlapping) return\n\n    // Find constraints for both directions\n    const prevEvent = sortedEvents.filter(ev => timeToMinutes(ev.end_time) <= startMins).pop()\n    const nextEvent = sortedEvents.find(ev => timeToMinutes(ev.start_time) >= startMins)\n\n    const minStartMins = prevEvent ? timeToMinutes(prevEvent.end_time) : startOffset\n    const maxEndMins = nextEvent ? timeToMinutes(nextEvent.start_time) : endTime * 60\n\n    setCreationStart(startMins)\n    setCurrentMouseY(startMins)\n    setIsCreating(true)\n\n    const handleGlobalMouseMove = (e: MouseEvent) => {\n      const currentMins = getMinutesFromY(e.clientY)\n\n      // Allow dragging both up and down, clamped to constraints\n      const clampedMins = Math.max(minStartMins, Math.min(currentMins, maxEndMins))\n\n      setCurrentMouseY(clampedMins)\n    }\n\n    const handleGlobalMouseUp = (e: MouseEvent) => {\n      const currentMins = getMinutesFromY(e.clientY)\n\n      // Determine start and end based on drag direction\n      let finalStart = Math.min(startMins, currentMins)\n      let finalEnd = Math.max(startMins, currentMins)\n\n      // Clamp to constraints\n      finalStart = Math.max(minStartMins, finalStart)\n      finalEnd = Math.min(maxEndMins, finalEnd)\n\n      // Ensure minimum size\n      if (finalEnd - finalStart < timeIncrements) {\n        finalEnd = Math.min(finalStart + timeIncrements, maxEndMins)\n      }\n\n      // Click-to-create 1 hour logic\n      if (finalEnd - finalStart <= timeIncrements) {\n        // Try 1 hour\n        const oneHourEnd = finalStart + 60\n        finalEnd = Math.min(oneHourEnd, maxEndMins)\n      }\n\n      if (finalEnd > finalStart) {\n        onCreate(colIndex, finalStart, finalEnd)\n      }\n\n      setIsCreating(false)\n      setCreationStart(null)\n      setCurrentMouseY(null)\n      window.removeEventListener(\"mousemove\", handleGlobalMouseMove)\n      window.removeEventListener(\"mouseup\", handleGlobalMouseUp)\n    }\n\n    window.addEventListener(\"mousemove\", handleGlobalMouseMove)\n    window.addEventListener(\"mouseup\", handleGlobalMouseUp)\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"flex-1 relative border-r last:border-r-0 min-w-[100px]\"\n      onMouseDown={handleMouseDown}\n    >\n      {sortedEvents.map((event, i) => {\n        const prevEvent = sortedEvents[i - 1]\n        const nextEvent = sortedEvents[i + 1]\n\n        const minStart = prevEvent ? timeToMinutes(prevEvent.end_time) : startOffset\n        const maxEnd = nextEvent ? timeToMinutes(nextEvent.start_time) : endTime * 60\n\n        return (\n          <DraggableTimeSpan\n            key={event.nanoid}\n            span={event}\n            startTime={startTime}\n            endTime={endTime}\n            minStart={minStart}\n            maxEnd={maxEnd}\n            onResize={onResize}\n            onDelete={onDelete}\n            useAmPm={useAmPm}\n            timeIncrements={timeIncrements}\n            containerRef={containerRef}\n          />\n        )\n      })}\n\n      {isCreating && creationStart !== null && currentMouseY !== null && (\n        <div\n          className=\"absolute left-0 right-0 mx-1 rounded bg-primary/30 border border-primary z-20 pointer-events-none\"\n          style={{\n            top: `${((Math.min(creationStart, currentMouseY) - startOffset) / totalMinutes) * 100}%`,\n            height: `${(Math.abs(currentMouseY - creationStart) / totalMinutes) * 100}%`,\n          }}\n        />\n      )}\n    </div>\n  )\n}\n\ninterface DraggableTimeSpanProps {\n  span: TimeSpan\n  startTime: number\n  endTime: number\n  minStart: number\n  maxEnd: number\n  onResize: (id: string, start: string, end: string) => void\n  onDelete: (id: string) => void\n  useAmPm: boolean\n  timeIncrements: number\n  containerRef: React.RefObject<HTMLDivElement | null>\n}\n\nfunction DraggableTimeSpan({\n  span,\n  startTime,\n  endTime,\n  minStart,\n  maxEnd,\n  onResize,\n  onDelete,\n  useAmPm,\n  timeIncrements,\n  containerRef,\n}: DraggableTimeSpanProps) {\n  const startMinutes = timeToMinutes(span.start_time)\n  const endMinutes = timeToMinutes(span.end_time)\n  const totalMinutes = (endTime - startTime) * 60\n  const startOffset = startTime * 60\n  const durationMinutes = endMinutes - startMinutes\n\n  const style: React.CSSProperties = {\n    top: `${((startMinutes - startOffset) / totalMinutes) * 100}%`,\n    height: `${(durationMinutes / totalMinutes) * 100}%`,\n  }\n\n  // Resize Handlers\n  const handleResizeStart = (e: React.MouseEvent, edge: \"top\" | \"bottom\") => {\n    e.stopPropagation() // Prevent drag start\n    e.preventDefault()\n\n    const initialY = e.clientY\n    const initialStart = startMinutes\n    const initialEnd = endMinutes\n\n    const handleMouseMove = (ev: MouseEvent) => {\n      if (!containerRef.current) return\n\n      const containerHeight = containerRef.current.clientHeight\n      const pixelsPerMinute = containerHeight / totalMinutes\n      const deltaY = ev.clientY - initialY\n      const deltaMinutes = Math.round(deltaY / pixelsPerMinute / timeIncrements) * timeIncrements\n\n      if (deltaMinutes === 0) return\n\n      let newStart = initialStart\n      let newEnd = initialEnd\n\n      if (edge === \"top\") {\n        newStart += deltaMinutes\n\n        // Clamp to limits\n        if (newStart < minStart) newStart = minStart\n        if (newStart >= newEnd - timeIncrements) newStart = newEnd - timeIncrements\n      } else {\n        newEnd += deltaMinutes\n\n        // Clamp to limits\n        if (newEnd > maxEnd) newEnd = maxEnd\n        if (newEnd <= newStart + timeIncrements) newEnd = newStart + timeIncrements\n      }\n\n      onResize(span.nanoid, minutesToTime(newStart), minutesToTime(newEnd))\n    }\n\n    const handleMouseUp = () => {\n      window.removeEventListener(\"mousemove\", handleMouseMove)\n      window.removeEventListener(\"mouseup\", handleMouseUp)\n    }\n\n    window.addEventListener(\"mousemove\", handleMouseMove)\n    window.addEventListener(\"mouseup\", handleMouseUp)\n  }\n\n  return (\n    <div\n      style={style}\n      className={cn(\n        \"absolute left-1 right-1 rounded-md border border-foreground/50 bg-foreground/10 p-2 text-primary-foreground shadow-sm text-xs group overflow-hidden\",\n      )}\n    >\n      {/* Resize Handle Top */}\n      <div\n        className=\"absolute top-0 left-0 right-0 h-2 cursor-n-resize hover:bg-foreground/20\"\n        onMouseDown={e => handleResizeStart(e, \"top\")}\n      />\n\n      <TimeSpanCard\n        span={span}\n        useAmPm={useAmPm}\n        duration={durationMinutes / 60}\n        onDelete={() => onDelete(span.nanoid)}\n      />\n\n      {/* Resize Handle Bottom */}\n      <div\n        className=\"absolute bottom-0 left-0 right-0 h-2 cursor-s-resize hover:bg-foreground/20\"\n        onMouseDown={e => handleResizeStart(e, \"bottom\")}\n      />\n    </div>\n  )\n}\n\nfunction TimeSpanCard({\n  span,\n  useAmPm,\n  isOverlay,\n  duration,\n  onDelete,\n}: {\n  span: TimeSpan\n  useAmPm: boolean\n  isOverlay?: boolean\n  duration?: number\n  onDelete?: () => void\n}) {\n  const calculatedDuration = duration || (timeToMinutes(span.end_time) - timeToMinutes(span.start_time)) / 60\n\n  return (\n    <div\n      className={cn(\n        \"h-full flex flex-col relative items-between text-foreground\",\n        isOverlay && \"rounded-md border p-2 shadow-lg w-[120px]\",\n      )}\n    >\n      <div className=\"flex flex-col gap-1 text-inherit\">\n        <p className=\"font-semibold leading-none\">{formatDisplayTime(span.start_time, useAmPm)}</p>\n        <p className=\"text-[10px] opacity-80\">{calculatedDuration.toFixed(1).replace(\".0\", \"\")}h</p>\n      </div>\n      {onDelete && (\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"h-5 w-5 hover:bg-foreground/20 -mt-1 -mr-1 absolute top-0 right-0\"\n          onMouseDown={e => {\n            e.stopPropagation() // prevent drag\n          }}\n          onClick={e => {\n            e.stopPropagation()\n            onDelete()\n          }}\n        >\n          <X className=\"h-3 w-3\" />\n        </Button>\n      )}\n      <div className=\"flex flex-col gap-1 mt-auto text-inherit\">\n        {!onDelete && <Settings className=\"h-3 w-3 opacity-50\" />}\n        <p className=\"font-semibold leading-none !text-inherit\">{formatDisplayTime(span.end_time, useAmPm)}</p>\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "components/ui/button.tsx",
      "content": "import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"cursor-pointer inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border bg-background shadow-xs hover:bg-accent dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\n        secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n        \"icon-sm\": \"size-8\",\n        \"icon-lg\": \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return <Comp data-slot=\"button\" className={cn(buttonVariants({ variant, size, className }))} {...props} />\n}\n\nexport { Button, buttonVariants }\n",
      "type": "registry:ui",
      "target": ""
    }
  ]
}
